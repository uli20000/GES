<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GES 成績達成計算器</title>
    <style>
        :root {
            --primary: #4a90e2;
            --secondary: #67c23a;
            --bg: #f5f7fa;
            --card: #ffffff;
        }
        body { 
            font-family: 'PingFang TC', sans-serif; 
            background-color: var(--bg); 
            display: flex; justify-content: center; align-items: center; 
            min-height: 100vh; margin: 0; 
        }
        .container { 
            width: 92%; max-width: 450px; background: var(--card); 
            padding: 25px; border-radius: 24px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.08); 
        }
        h2 { text-align: center; color: var(--primary); margin-bottom: 20px; letter-spacing: 1px; }
        
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 6px; font-weight: 600; color: #444; font-size: 15px; }
        
        select, input { 
            width: 100%; padding: 14px; border: 1.5px solid #eee; 
            border-radius: 12px; font-size: 16px; box-sizing: border-box;
            background-color: #fcfcfc; transition: all 0.3s ease;
        }
        input:focus { border-color: var(--primary); outline: none; background-color: #fff; }

        .score-grid { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; 
            background: #f9f9f9; padding: 15px; border-radius: 16px; margin-bottom: 20px;
        }

        button { 
            width: 100%; padding: 16px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white; border: none; border-radius: 14px; font-size: 18px; font-weight: bold; 
            cursor: pointer; transition: transform 0.2s; box-shadow: 0 5px 15px rgba(79,172,254,0.4);
        }
        button:active { transform: scale(0.98); }

        .result-box { 
            margin-top: 25px; border-radius: 16px; display: none; overflow: hidden;
            border: 1px solid #edf2f7;
        }
        .res-header { background: #f8fafc; padding: 10px; text-align: center; font-size: 14px; color: #64748b; border-bottom: 1px solid #edf2f7; }
        .res-body { padding: 15px; }
        .res-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; }
        .tag { padding: 4px 10px; border-radius: 8px; font-weight: bold; font-size: 14px; }
        .tag-osat { background: #e1effe; color: #1e429f; }
        .tag-sos { background: #e1f5fe; color: #0277bd; }
        .gap-num { color: #e74c3c; font-size: 1.2em; font-weight: bold; }
        .pass-text { color: var(--secondary); font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2>GES 計算器</h2>
    
    <div class="form-group">
        <label>區經理</label>
        <select id="manager">
            <option value="Renee">Renee</option>
            <option value="Ean">Ean</option>
            <option value="Carol">Carol</option>
            <option value="Chance">Chance</option>
            <option value="Jewel">Jewel</option>
        </select>
    </div>

    <div class="form-group">
        <label>共用總份數 (n)</label>
        <input type="number" id="totalCount" placeholder="請輸入目前總份數">
    </div>

    <div class="score-grid">
        <div class="form-group" style="margin-bottom:0">
            <label>OSAT 成績 %</label>
            <input type="number" id="osatScore" step="0.1" placeholder="例如 75">
        </div>
        <div class="form-group" style="margin-bottom:0">
            <label>SOS 成績 %</label>
            <input type="number" id="sosScore" step="0.1" placeholder="例如 78">
        </div>
    </div>

    <button onclick="calculate()">開始計算</button>

    <div id="resultBox" class="result-box">
        <div class="res-header" id="resManager"></div>
        <div class="res-body">
            <div class="res-row">
                <span class="tag tag-osat">OSAT</span>
                <span id="osatVal"></span>
            </div>
            <div class="res-row">
                <span class="tag tag-sos">SOS</span>
                <span id="sosVal"></span>
            </div>
        </div>
    </div>
</div>

<script>
    window.onload = function() {
        const saved = JSON.parse(localStorage.getItem('gesDataV3'));
        if (saved) {
            document.getElementById('manager').value = saved.manager;
            document.getElementById('totalCount').value = saved.count;
            document.getElementById('osatScore').value = saved.osat;
            document.getElementById('sosScore').value = saved.sos;
            calculate();
        }
    };

    function calculate() {
        const manager = document.getElementById('manager').value;
        const n = parseFloat(document.getElementById('totalCount').value);
        const sOsat = parseFloat(document.getElementById('osatScore').value);
        const sSos = parseFloat(document.getElementById('sosScore').value);
        const T = 81;

        if (isNaN(n)) { alert("請輸入份數"); return; }

        localStorage.setItem('gesDataV3', JSON.stringify({manager, count: n, osat: sOsat, sos: sSos}));

        document.getElementById('resManager').innerText = `經理：${manager} (目前 ${n} 份)`;
        document.getElementById('resultBox').style.display = "block";

        showResult('osatVal', n, sOsat, T);
        showResult('sosVal', n, sSos, T);
    }

    function showResult(elementId, n, S, T) {
        const el = document.getElementById(elementId);
        if (isNaN(S)) { el.innerHTML = "未輸入"; return; }
        
        if (S >= T) {
            el.innerHTML = `<span class="pass-text">已達標 ✓</span>`;
        } else {
            const gap = Math.ceil((n * (T - S)) / (100 - T));
            el.innerHTML = `還差 <span class="gap-num">${gap}</span> 份滿分`;
        }
    }
</script>

</body>
</html>
